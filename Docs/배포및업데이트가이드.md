# ìœ„ìŠ¤í‚¤ ë…¸íŠ¸ ì•± - ë°°í¬ ë° ì—…ë°ì´íŠ¸ ê°€ì´ë“œ

## 1. í˜„ì¬ ìƒíƒœ ìš”ì•½

### ì™„ë£Œëœ ì‘ì—…
- âœ… PWA(Progressive Web App) ì„¤ì • ì™„ë£Œ
- âœ… Service Worker êµ¬í˜„ ë° ì˜¤í”„ë¼ì¸ ì§€ì›
- âœ… PWA ì„¤ì¹˜ ë²„íŠ¼ ì¶”ê°€
- âœ… ë¹Œë“œ ìµœì í™” (ê²½ê³  ì œê±°)
- âœ… ì˜¤í”„ë¼ì¸ ìºì‹± ì „ëµ êµ¬í˜„
- âœ… ìë™ ì—…ë°ì´íŠ¸ ì•Œë¦¼ ê¸°ëŠ¥

### êµ¬í˜„ëœ ê¸°ëŠ¥
1. **Service Worker** (`public/sw.js`)
   - ì •ì  ìì‚° ìºì‹±
   - ë„¤íŠ¸ì›Œí¬ ìš°ì„ /ìºì‹œ ìš°ì„  ì „ëµ
   - ì˜¤í”„ë¼ì¸ ì§€ì›

2. **PWA ì„¤ì¹˜ ê¸°ëŠ¥** (`src/components/InstallButton.tsx`)
   - ì•± ì„¤ì¹˜ ê°€ëŠ¥ ìƒíƒœ ê°ì§€
   - ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
   - ì„¤ì¹˜ ì™„ë£Œ í›„ ë²„íŠ¼ ìˆ¨ê¹€

3. **ìë™ ì—…ë°ì´íŠ¸** (`src/main.tsx`)
   - ìƒˆ ë²„ì „ ê°ì§€
   - ì‚¬ìš©ìì—ê²Œ ìƒˆë¡œê³ ì¹¨ ì•ˆë‚´

---

## 2. ê°œë°œ ì›Œí¬í”Œë¡œìš°

### 2.1 ì†ŒìŠ¤ ìˆ˜ì • í›„ ë°°í¬ ê³¼ì •

#### Step 1: ì½”ë“œ ìˆ˜ì •
```bash
# ê°œë°œ ì„œë²„ ì‹¤í–‰ (ìë™ ìƒˆë¡œê³ ì¹¨ë¨)
npm run dev
```

#### Step 2: ë¹Œë“œ
```bash
cd whiskey-notes-app
npm run build
```

#### Step 3: ë°°í¬ íŒŒì¼ ë³µì‚¬
```powershell
# Service Worker íŒŒì¼ ë³µì‚¬
Copy-Item -Path "public\sw.js" -Destination "dist\sw.js" -Force

# Manifest íŒŒì¼ ë³µì‚¬
Copy-Item -Path "public\manifest.json" -Destination "dist\manifest.json" -Force

# ì•„ì´ì½˜ íŒŒì¼ ë³µì‚¬ (í•„ìš”ì‹œ)
Copy-Item -Path "public\img" -Destination "dist\img" -Recurse -Force
```

#### Step 4: ë°°í¬
- `dist` í´ë”ì˜ ëª¨ë“  íŒŒì¼ì„ ì›¹ ì„œë²„ì— ì—…ë¡œë“œ
- ë˜ëŠ” Vercel, Netlify ë“±ì— ìë™ ë°°í¬ ì„¤ì •

---

## 3. ì—…ë°ì´íŠ¸ ë©”ì»¤ë‹ˆì¦˜

### 3.1 Service Worker ë²„ì „ ê´€ë¦¬

Service WorkerëŠ” **ë²„ì „ ê¸°ë°˜ ìºì‹±**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

**íŒŒì¼**: `public/sw.js`
```javascript
const CACHE_NAME = 'whiskey-notes-v6';  // ë²„ì „ ë²ˆí˜¸ ë³€ê²½
```

#### ì—…ë°ì´íŠ¸ ì‹œ ë³€ê²½ ì‚¬í•­

1. **Service Worker ë²„ì „ ì—…ë°ì´íŠ¸**
   ```javascript
   const CACHE_NAME = 'whiskey-notes-v7';  // v5 â†’ v7ë¡œ ë³€ê²½
   ```

2. **ë¹Œë“œ ë° ë°°í¬**
   ```bash
   npm run build
   # dist í´ë” ë°°í¬
   ```

3. **ì‚¬ìš©ì ì¸¡ì—ì„œ ìë™ ê°ì§€**
   - ìƒˆ ë²„ì „ ê°ì§€ ì‹œ "ìƒˆ ë²„ì „ì´ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤" ì•Œë¦¼
   - ì‚¬ìš©ìê°€ ìƒˆë¡œê³ ì¹¨ ì‹œ ìµœì‹  ë²„ì „ ì ìš©

### 3.2 ê°•ì œ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•œ ê²½ìš°

ê¸°ì¡´ Service Workerë¥¼ ê°•ì œë¡œ ì œê±°í•˜ë ¤ë©´:

```javascript
// sw.jsì˜ activate ì´ë²¤íŠ¸
self.addEventListener('activate', (event) => {
  event.waitUntil(
    caches.keys()
      .then((cacheNames) => {
        return Promise.all(
          cacheNames.map((cacheName) => {
            console.log('Deleting cache:', cacheName);
            return caches.delete(cacheName);  // ëª¨ë“  ìºì‹œ ì‚­ì œ
          })
        );
      })
      .then(() => {
        return self.clients.claim();  // ì¦‰ì‹œ ì ìš©
      })
  );
});
```

---

## 4. ìë™ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸

### 4.1 ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±

**íŒŒì¼**: `whiskey-notes-app/scripts/deploy.js`

```javascript
const fs = require('fs');
const path = require('path');

// Service Worker ë²„ì „ ìë™ ì¦ê°€
function updateServiceWorkerVersion() {
  const swPath = path.join(__dirname, '..', 'public', 'sw.js');
  let content = fs.readFileSync(swPath, 'utf8');
  
  // í˜„ì¬ ë²„ì „ ì¶”ì¶œ
  const versionMatch = content.match(/whiskey-notes-v(\d+)/);
  if (versionMatch) {
    const currentVersion = parseInt(versionMatch[1]);
    const newVersion = currentVersion + 1;
    
    // ë²„ì „ ì—…ë°ì´íŠ¸
    content = content.replace(
      /const CACHE_NAME = 'whiskey-notes-v\d+';/g,
      `const CACHE_NAME = 'whiskey-notes-v${newVersion}';`
    );
    
    fs.writeFileSync(swPath, content, 'utf8');
    console.log(`âœ… Service Worker ë²„ì „ ì—…ë°ì´íŠ¸: v${currentVersion} â†’ v${newVersion}`);
  }
}

updateServiceWorkerVersion();
```

### 4.2 package.jsonì— ë°°í¬ ëª…ë ¹ ì¶”ê°€

```json
{
  "scripts": {
    "build": "tsc -b && vite build",
    "build:deploy": "node scripts/deploy.js && npm run build"
  }
}
```

### 4.3 ì‚¬ìš© ë°©ë²•

```bash
# ë°°í¬ìš© ë¹Œë“œ (ë²„ì „ ìë™ ì¦ê°€)
npm run build:deploy

# ì¼ë°˜ ë¹Œë“œ
npm run build
```

---

## 5. ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ ì „ í™•ì¸ ì‚¬í•­

- [ ] Service Worker ë²„ì „ ì—…ë°ì´íŠ¸
- [ ] ë¹Œë“œ ì„±ê³µ (ê²½ê³  ì—†ìŒ)
- [ ] `dist/sw.js` íŒŒì¼ ì¡´ì¬ í™•ì¸
- [ ] `dist/manifest.json` íŒŒì¼ ì¡´ì¬ í™•ì¸
- [ ] ì•„ì´ì½˜ íŒŒì¼ í™•ì¸
- [ ] ì˜¤í”„ë¼ì¸ í…ŒìŠ¤íŠ¸
- [ ] PWA ì„¤ì¹˜ í…ŒìŠ¤íŠ¸
- [ ] ìë™ ì—…ë°ì´íŠ¸ ë™ì‘ í™•ì¸

### ë°°í¬ í›„ í™•ì¸ ì‚¬í•­

- [ ] ìƒˆ ë²„ì „ìœ¼ë¡œ ì •ìƒ ì ‘ì† ê°€ëŠ¥
- [ ] ì˜¤í”„ë¼ì¸ ëª¨ë“œì—ì„œ ë™ì‘
- [ ] ì•± ì„¤ì¹˜ ê°€ëŠ¥
- [ ] ì—…ë°ì´íŠ¸ ì•Œë¦¼ ì •ìƒ ë™ì‘

---

## 6. ë¬¸ì œ í•´ê²°

### 6.1 ìºì‹œê°€ ë‚¨ì•„ìˆëŠ” ê²½ìš°

#### ì‚¬ìš©ì ì¸¡
```
1. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ (F12)
2. Application íƒ­
3. Storage â†’ Clear site data
4. Service Workers â†’ Unregister
5. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (Ctrl+Shift+R)
```

#### ê´€ë¦¬ì ì¸¡
Service Worker ë²„ì „ì„ ë†’ì´ê³  ë°°í¬

### 6.2 ì—…ë°ì´íŠ¸ê°€ ê°ì§€ë˜ì§€ ì•ŠëŠ” ê²½ìš°

1. Service Worker ë²„ì „ í™•ì¸
2. ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ
3. ë°°í¬ ì„œë²„ì—ì„œ ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì„¤ì •

### 6.3 PWA ì„¤ì¹˜ ë²„íŠ¼ì´ ë‚˜íƒ€ë‚˜ì§€ ì•ŠëŠ” ê²½ìš°

**ì¡°ê±´**:
- HTTPS í™˜ê²½ (ë˜ëŠ” localhost)
- ìœ íš¨í•œ manifest.json
- Service Worker ë“±ë¡ë¨
- beforeinstallprompt ì´ë²¤íŠ¸ ë°œìƒ

**í•´ê²°**:
```javascript
// ì½˜ì†”ì—ì„œ í™•ì¸
navigator.serviceWorker.ready.then(reg => console.log('SW ready:', reg));
```

---

## 7. ìë™ ë°°í¬ ì„¤ì • (Vercel)

### 7.1 Vercel ë°°í¬ ì„¤ì •

**íŒŒì¼**: `vercel.json`

```json
{
  "buildCommand": "cd whiskey-notes-app && npm run build",
  "outputDirectory": "whiskey-notes-app/dist",
  "headers": [
    {
      "source": "/sw.js",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "no-cache, no-store, must-revalidate"
        }
      ]
    },
    {
      "source": "/manifest.json",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "no-cache"
        }
      ]
    }
  ]
}
```

### 7.2 GitHub ì—°ë™

1. GitHub ì €ì¥ì†Œì— ì½”ë“œ í‘¸ì‹œ
2. Vercelì— ì €ì¥ì†Œ ì—°ê²°
3. ìë™ ë°°í¬ ì„¤ì • ì™„ë£Œ

### 7.3 í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

Vercel ëŒ€ì‹œë³´ë“œì—ì„œ:
- `VITE_SUPABASE_URL`
- `VITE_SUPABASE_ANON_KEY`

---

## 8. ë¹Œë“œ ìµœì í™” íŒ

### 8.1 ë²ˆë“¤ í¬ê¸° ìµœì í™”

```bash
# ë¹Œë“œ í›„ ë²ˆë“¤ í¬ê¸° í™•ì¸
npm run build
# ê²°ê³¼ í™•ì¸
```

### 8.2 ë¯¸ì‚¬ìš© ì½”ë“œ ì œê±°

```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'vendor': ['react', 'react-dom', 'react-router-dom'],
          'supabase': ['@supabase/supabase-js'],
        }
      }
    }
  }
});
```

---

## 9. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 9.1 Service Worker ë¡œê·¸ í™•ì¸

```javascript
// main.tsxì— ì´ë¯¸ êµ¬í˜„ë¨
console.log('âœ… Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
console.log('ğŸ”„ ìƒˆ ë²„ì „ì´ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
console.log('ğŸŒ ì˜¨ë¼ì¸ ìƒíƒœë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
console.log('ğŸ“´ ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤.');
```

### 9.2 ì—ëŸ¬ ì¶”ì 

Service Worker ì˜¤ë¥˜ëŠ” ìë™ìœ¼ë¡œ ì½˜ì†”ì— ì¶œë ¥ë©ë‹ˆë‹¤.

---

## 10. ì°¸ê³  ìë£Œ

- [Vite ê³µì‹ ë¬¸ì„œ](https://vitejs.dev/)
- [PWA ê°€ì´ë“œ](https://web.dev/progressive-web-apps/)
- [Service Worker API](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)
- [Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest)

---

## ê²°ë¡ 

### âœ… í˜„ì¬ ìƒíƒœ
- ëª¨ë“  ê¸°ë³¸ ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ
- PWA ê¸°ëŠ¥ ì™„ì „ êµ¬í˜„
- ë°°í¬ ì¤€ë¹„ ì™„ë£Œ

### ğŸ“ ì´í›„ ì‘ì—…
1. ì†ŒìŠ¤ ì½”ë“œ ìˆ˜ì •
2. `npm run build` ì‹¤í–‰
3. `dist` í´ë” ë°°í¬
4. ìë™ ì—…ë°ì´íŠ¸ ì•Œë¦¼ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ë°°í¬

### ğŸ”„ ì—…ë°ì´íŠ¸ íë¦„
```
ê°œë°œ â†’ ë¹Œë“œ â†’ ë°°í¬ â†’ ìë™ ê°ì§€ â†’ ì‚¬ìš©ì ìƒˆë¡œê³ ì¹¨ â†’ ìµœì‹  ë²„ì „
```

ëª¨ë“  ê²ƒì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰
