# 위스키 가격 추적 기능 사용 가이드

## 개요

이 기능은 위스키의 현재 시장 가격을 수집하고 추적하며, 가격대별로 분류하여 표시합니다.

## 기능

### 1. 가격 추적
- 위스키의 가격 이력을 저장
- 여러 소스에서 가격 정보 수집
- 최신 가격을 현재 가격으로 표시

### 2. 가격대 표시
- 5만원 미만
- 5~10만원
- 10~20만원
- 20~30만원
- 30~50만원
- 50~100만원
- 100~200만원
- 200~500만원
- 500만원 이상

## 설치 및 설정

### 1. 데이터베이스 스키마 업데이트

```bash
# Supabase SQL 에디터에서 다음 SQL 실행
```

`Docs/database/add-price-tracking.sql` 파일의 내용을 Supabase SQL Editor에서 실행합니다.

주요 추가 사항:
- `whiskey_prices` 테이블: 가격 이력 저장
- `whiskeys` 테이블에 가격 관련 컬럼 추가
- 가격 업데이트 트리거 설정
- 가격 통계 뷰 생성

### 2. 환경 변수 설정

`.env` 파일에 다음 변수 추가 (필요시):

```env
# 네이버 쇼핑 API (선택사항)
NAVER_CLIENT_ID=your_client_id
NAVER_CLIENT_SECRET=your_client_secret

# 환율 API (선택사항)
# ExchangeRate-API: https://www.exchangerate-api.com/
VITE_EXCHANGE_API_KEY=your_exchange_api_key

# 한국수출입은행 환율 API (선택사항)
# https://www.koreaexim.go.kr/ir/HPHKBM0200
VITE_KOREAEXIM_API_KEY=your_koreaexim_api_key
```

**환율 API 서비스:**
- ExchangeRate-API: 무료 (월 1,500회 제한)
- 한국수출입은행: 무료 (제한 없음, 공휴일 제외)

## 사용 방법

### 1. 가격 정보 표시

위스키 목록에서 자동으로 가격대가 표시됩니다:

```
₩150,000
[10~20만원]
```

### 2. 가격 업데이트 (수동)

#### 방법 1: 위스키 상세 페이지에서 업데이트

위스키 상세 페이지에서 "가격 업데이트" 버튼을 클릭합니다.

#### 방법 2: API를 통한 일괄 업데이트

```typescript
import { updateWhiskeyPrices, collectWhiskeyPrice } from '../utils/priceCollector';

// 단일 위스키 가격 업데이트
const priceInfo = await collectWhiskeyPrice(whiskeyId, whiskeyName);
if (priceInfo) {
  await savePriceInfo(whiskeyId, priceInfo);
}

// 여러 위스키 가격 일괄 업데이트
const results = await updateWhiskeyPrices([whiskeyId1, whiskeyId2, whiskeyId3]);
console.log(`성공: ${results.success}, 실패: ${results.failed}`);
```

### 3. 가격 이력 조회

```typescript
import { getPriceHistory } from '../utils/priceCollector';

// 최근 10개 가격 이력 조회
const history = await getPriceHistory(whiskeyId, 10);
```

## 데이터베이스 구조

### whiskey_prices 테이블

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | UUID | 고유 식별자 |
| whiskey_id | UUID | 위스키 ID (FK) |
| price | DECIMAL(10,2) | 가격 |
| price_date | DATE | 가격 수집일 |
| source | VARCHAR(255) | 가격 출처 |
| source_url | VARCHAR(500) | 가격 출처 URL |
| currency | VARCHAR(10) | 통화 (기본: KRW) |
| created_at | TIMESTAMP | 생성일시 |

### whiskeys 테이블 추가 컬럼

| 컬럼 | 타입 | 설명 |
|------|------|------|
| current_price | DECIMAL(10,2) | 최신 가격 (KRW) |
| current_price_usd | DECIMAL(10,2) | 최신 가격 (USD) |
| exchange_rate | DECIMAL(10,4) | 환율 (KRW/USD) |
| price_range_min | DECIMAL(10,2) | 최저 가격 범위 |
| price_range_max | DECIMAL(10,2) | 최고 가격 범위 |
| last_price_update | TIMESTAMP | 마지막 가격 업데이트 일시 |
| price_source | VARCHAR(255) | 가격 출처 |

## 가격 수집 소스

현재 지원하는 소스:
1. 수동 입력
2. 네이버 쇼핑 API (예정)
3. 다음 쇼핑 API (예정)
4. 크롤링 (예정)

## API 참조

### `collectWhiskeyPrice(whiskeyId: string, whiskeyName: string)`

위스키 가격을 수집합니다.

**Parameters:**
- `whiskeyId`: 위스키 ID
- `whiskeyName`: 위스키 이름

**Returns:** `Promise<PriceInfo | null>`

### `savePriceInfo(whiskeyId: string, priceInfo: PriceInfo)`

가격 정보를 데이터베이스에 저장합니다.

**Parameters:**
- `whiskeyId`: 위스키 ID
- `priceInfo`: 가격 정보 객체

**Returns:** `Promise<boolean>`

### `getPriceRange(price: number)`

가격을 가격대로 변환합니다.

**Parameters:**
- `price`: 가격 값

**Returns:** `string` (예: "10~20만원")

## 활용 예시

### 1. 관리자 페이지에 가격 업데이트 버튼 추가

```tsx
import { updateWhiskeyPrices } from '../utils/priceCollector';

const handleUpdatePrices = async () => {
  const whiskeyIds = whiskeys.map(w => w.id);
  const result = await updateWhiskeyPrices(whiskeyIds);
  alert(`성공: ${result.success}, 실패: ${result.failed}`);
};
```

### 2. 가격대별 필터링

```typescript
const filtered = whiskeys.filter(whiskey => {
  const priceRange = getPriceRange(whiskey.price);
  return priceRange === '10~20만원';
});
```

### 3. 가격 변동 추이 그래프

```typescript
const history = await getPriceHistory(whiskeyId, 30);
// 최근 30일 가격 이력을 사용하여 그래프 표시
```

## 주의사항

1. **웹 크롤링 법적 고려사항**
   - 각 웹사이트의 robots.txt 및 이용약관을 확인하세요
   - 과도한 요청은 IP 차단을 받을 수 있습니다

2. **데이터 정확성**
   - 수집된 가격은 참고용입니다
   - 최종 구매 결정은 반드시 확인 후 진행하세요

3. **API 키 관리**
   - API 키는 `.env` 파일에 저장하고 Git에 커밋하지 마세요
   - `.gitignore`에 `.env`가 포함되어 있는지 확인하세요

## 향후 개선 계획

- [ ] 자동 가격 업데이트 스케줄러
- [ ] 가격 변동 알림 기능
- [ ] 가격 비교 차트
- [ ] 지역별 가격 정보
- [ ] 할인 정보 추적

